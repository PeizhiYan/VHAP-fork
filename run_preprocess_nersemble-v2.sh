#! /bin/sh

DATASET_PATH="/mnt/data4_hdd/peizhi/Datasets/nersemble-data"

# SUBJECT="074"
# SEQUENCE="EMO-1"

# # preprocess videos to get alpha_maps and downsampled image
# python vhap/preprocess_video.py \
# --input ${DATASET_PATH}/${SUBJECT}/sequences/${SEQUENCE}* \
# --downsample_scales 4 \
# --matting_method background_matting_v2

# # remove the extracted original frames to save space
# rm -f ${DATASET_PATH}/${SUBJECT}/sequences/${SEQUENCE}*/images/*.jpg


SUBJECT_LIST=("017" "018" "024" "030" "031" "032" "033" "035" "036" "037" "038" "040" "042" "043" "055" "056" "057" "058" "059" "060" "061" "063" "064" "065" "067" "068" "069" "070" "071" "072" "073" "074" "075" "076" "077" "078" "079" "080" "081" "082" "083" "085" "088" "089" "090" "091" "092" "093" "094" "095" "096" "097" "098" "099" "100" "102" "104" "105" "106" "107" "108" "109" "110" "111" "112" "113" "114" "115" "116" "117" "120" "121" "122" "123" "124" "125" "126" "127" "128" "129" "130" "131" "132" "133" "134" "135" "136" "137" "138" "139" "140" "141" "142" "143" "144" "145" "146" "147" "148" "149" "150" "151" "162" "163" "164" "165" "166" "167" "168" "170" "171" "172" "173" "174" "175" "176" "177" "178" "179" "180" "181" "182" "183" "184" "185" "186" "187" "188" "189" "190" "191" "192" "193" "194" "195" "196" "197" "198" "199" "200" "201" "202" "204" "206" "207" "209" "210" "211" "212" "214" "215" "216" "217" "218" "220" "221" "222" "223" "224" "225" "226" "227" "228" "229" "230" "231" "232" "233" "234" "235" "236" "237" "238" "239" "240" "241" "242" "243" "244" "245" "246" "247" "248" "249" "250" "251" "252" "253" "254" "256" "257" "258" "259" "260" "261" "262" "263" "264" "266" "267" "269" "270" "271" "272" "274" "275" "276" "277" "278" "279" "280" "281" "282" "283" "284" "285" "286" "287" "288" "289" "290" "293" "294" "295" "297" "298" "299" "301" "302" "303" "304" "305" "306" "307" "308" "309" "310" "311" "312" "313" "314" "315" "316" "317" "318" "319" "320" "321" "322" "323" "324" "325" "326" "327" "328" "330" "331" "332" "333" "350" "368" "369" "370" "371" "372" "373" "374" "375" "376" "377" "378" "379" "380" "381" "382" "383" "384" "385" "386" "387" "388" "389" "391" "392" "395" "396" "397" "398" "400" "401" "402" "403" "405" "406" "407" "409" "410" "411" "412" "413" "414" "415" "416" "417" "418" "419" "420" "421" "422" "424" "425" "426" "427" "428" "429" "430" "431" "432" "433" "434" "435" "436" "437" "438" "439" "440" "441" "442" "443" "444" "445" "446" "447" "448" "449" "450" "451" "453" "455" "456" "457" "458" "459" "460" "462" "463" "464" "465" "466" "467" "468" "469" "470" "471" "472" "473" "474" "475" "476" "478" "479" "480" "481" "483" "484" "485" "487" "488" "489" "490" "491" "492" "494" "495" "496" "497" "498" "499" "500" "501" "503" "504" "505" "506" "508" "509" "510" "511" "512" "513" "514" "515" "516" "517" "518" "519" "520" "521" "522" "523" "525" "526" "527" "528" "531" "532" "533" "534" "535" "536" "537" "538" "539" "545" "546" "548" "549" "552" "553")
# SUBJECT_LIST=("293" "294" "295" "297" "298" "299" "301" "302" "303" "304" "305" "306" "307" "308" "309" "310" "311" "312" "313" "314" "315" "316" "317" "318" "319" "320" "321" "322" "323" "324" "325" "326" "327" "328" "330" "331" "332" "333" "350" "368" "369" "370" "371" "372" "373" "374" "375" "376" "377" "378" "379" "380" "381" "382" "383" "384" "385" "386" "387" "388" "389" "391" "392" "395" "396" "397" "398" "400" "401" "402" "403" "405" "406" "407" "409" "410" "411" "412" "413" "414" "415" "416" "417" "418" "419" "420" "421" "422" "424" "425" "426" "427" "428" "429" "430" "431" "432" "433")
# SUBJECT_LIST=("434" "435" "436" "437" "438" "439" "440" "441" "442" "443" "444" "445" "446" "447" "448" "449" "450" "451" "453" "455" "456" "457" "458" "459" "460" "462" "463" "464" "465" "466" "467" "468" "469" "470" "471" "472" "473" "474" "475" "476" "478" "479" "480" "481" "483" "484" "485" "487" "488" "489" "490" "491" "492" "494" "495" "496" "497" "498" "499" "500" "501" "503" "504" "505" "506" "508" "509" "510" "511" "512" "513" "514" "515" "516" "517" "518" "519" "520" "521" "522" "523" "525" "526" "527" "528" "531" "532" "533" "534" "535" "536" "537" "538" "539" "545" "546" "548" "549" "552" "553")

SEQUENCE_LIST=("EMO-1" "EMO-2" "EMO-3" "EMO-4" "EXP-1" "EXP-2" "EXP-3" "EXP-4" "EXP-5" "EXP-8" "EXP-9" "FREE")

# Loop over all subjects and sequences
for SUBJECT in "${SUBJECT_LIST[@]}"; do
  for SEQUENCE in "${SEQUENCE_LIST[@]}"; do

    INPUT_PATH="${DATASET_PATH}/${SUBJECT}/sequences/${SEQUENCE}"*

    # Check if matching path exists
    if compgen -G "$INPUT_PATH" > /dev/null; then
      echo "Processing SUBJECT: $SUBJECT, SEQUENCE: $SEQUENCE"

      # Run preprocessing script
      python vhap/preprocess_video.py \
      --input ${INPUT_PATH} \
      --downsample_scales 4 \
      --matting_method background_matting_v2

      # Remove extracted original frames
      rm -f ${INPUT_PATH}/images/*.jpg
    else
      echo "Skipping SUBJECT: $SUBJECT, SEQUENCE: $SEQUENCE (path not found)"
    fi

  done
done




# TRACK_OUTPUT_FOLDER="/mnt/data4_hdd/peizhi/Datasets/nersemble-v2-vhap/${SUBJECT}/${SEQUENCE}"

# python vhap/track_nersemble_v2.py --data.root_folder ${DATASET_PATH} \
# --exp.output_folder $TRACK_OUTPUT_FOLDER \
# --data.subject $SUBJECT --data.sequence $SEQUENCE \
# --data.n_downsample_rgb 4

